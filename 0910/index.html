<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KOKO - Korean Product Guide</title>
    <style>
        /* --- Í∏∞Î≥∏ & ÎîîÏûêÏù∏ ÏãúÏä§ÌÖú --- */
        :root {
            --primary-black: #000000;
            --primary-white: #ffffff;
            --accent-gray: #666666;
            --light-gray: #f5f5f5;
            --medium-gray: #dddddd;
            --system-blue: #007AFF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--primary-white);
            color: var(--primary-black);
            line-height: 1.6;
            overflow-x: hidden;
            cursor: none; /* Ïª§Ïä§ÌÖÄ Ïª§ÏÑú ÏÇ¨Ïö© */
        }

        a, button {
            cursor: none;
        }

        /* --- Ïú†Ìã∏Î¶¨Ìã∞ & Ïï†ÎãàÎ©îÏù¥ÏÖò --- */
        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* --- Ïª§Ïä§ÌÖÄ Ïª§ÏÑú --- */
        .cursor {
            position: fixed;
            width: 20px;
            height: 20px;
            background: var(--primary-black);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            transition: transform 0.15s ease-out, background-color 0.2s ease, width 0.2s ease, height 0.2s ease;
            mix-blend-mode: difference;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .cursor.hover {
            transform: scale(1.5);
        }

        /* --- Ïä§ÌîåÎûòÏãú ÌôîÎ©¥ --- */
        .splash-screen {
            position: fixed; inset: 0; background: var(--primary-white);
            z-index: 10000; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            transition: opacity 0.5s ease-in-out;
        }
        .splash-screen.fade-out { opacity: 0; }
        .splash-logo { font-size: 60px; margin-bottom: 1rem; }
        .splash-title { font-size: 2rem; font-weight: 600; letter-spacing: -0.02em; }

        /* --- ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò --- */
        .navbar {
            position: fixed; top: 0; left: 0; right: 0; z-index: 1000;
            padding: 2rem 3rem; backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.85);
            border-bottom: 1px solid var(--light-gray);
        }
        .nav-container {
            display: flex; justify-content: space-between; align-items: center;
            max-width: 1400px; margin: 0 auto;
        }
        .logo { font-size: 1.2rem; font-weight: 600; }
        .lang-btn {
            padding: 8px 16px; background: transparent; border: 1px solid var(--medium-gray);
            border-radius: 20px; font-size: 14px; font-weight: 500;
            display: flex; align-items: center; gap: 8px; transition: background-color 0.3s;
        }
        .lang-btn:hover { background-color: var(--light-gray); }

        /* --- Î©îÏù∏ Ïª®ÌÖåÏù¥ÎÑà & ÌéòÏù¥ÏßÄ --- */
        .main-container {
            max-width: 1400px; margin: 0 auto; padding: 0 3rem;
        }
        .page {
            min-height: 100vh; padding-top: 8rem; display: none;
        }
        .page.active { display: block; }
        .page-header {
            padding: 2rem 0;
            display: flex; align-items: center; gap: 1rem;
            border-bottom: 1px solid var(--light-gray);
        }
        .back-btn {
            font-size: 1.5rem; background: none; border: none;
        }
        .page-title {
            font-size: 1.5rem; font-weight: 600;
        }

        /* --- ÏÑπÏÖò Ìó§Îçî --- */
        .section-header {
            margin-bottom: 4rem;
        }
        .section-title {
            font-size: clamp(2.5rem, 5vw, 4rem); font-weight: 300;
            letter-spacing: -0.03em; margin-bottom: 1rem;
        }
        .section-subtitle {
            font-size: 1.2rem; color: var(--accent-gray);
            font-weight: 300; max-width: 600px;
        }

        /* --- Ìôà ÌéòÏù¥ÏßÄ --- */
        .home-section {
            min-height: calc(100vh - 8rem);
            display: flex; flex-direction: column; justify-content: center;
        }
        .search-options-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }
        .search-option-card {
            padding: 2.5rem; border: 1px solid var(--light-gray);
            transition: all 0.4s ease;
        }
        .search-option-card:hover {
            background: var(--light-gray); transform: translateY(-5px);
        }
        .option-icon { font-size: 2.5rem; margin-bottom: 1.5rem; }
        .option-title { font-size: 1.5rem; font-weight: 500; margin-bottom: 0.5rem; }
        .option-desc { font-size: 1rem; color: var(--accent-gray); }

        /* --- Í≤ÄÏÉâ Í≤∞Í≥º ÌéòÏù¥ÏßÄ --- */
        #searchResults .page-header { position: sticky; top: 97px; background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(10px); }
        .search-input {
            flex: 1; border: none; background: transparent;
            font-size: 1.5rem; font-weight: 500; outline: none; padding: 0.5rem 0;
        }
        .results-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem; padding: 4rem 0;
        }
        .result-card {
            padding: 2rem; border: 1px solid var(--light-gray);
            transition: all 0.4s ease;
        }
        .result-card:hover { background: var(--light-gray); transform: translateY(-5px); }
        .result-name { font-size: 1.2rem; font-weight: 500; margin-bottom: 0.5rem; }
        .result-desc { font-size: 0.9rem; color: var(--accent-gray); margin-bottom: 1rem; }
        .result-company { font-size: 0.9rem; color: var(--system-blue); font-weight: 500; }
        
        /* --- ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ --- */
        .detail-content { padding: 4rem 0; }
        .detail-hero {
            height: 250px; background: var(--light-gray);
            display: flex; align-items: center; justify-content: center;
            font-size: 5rem; margin-bottom: 3rem;
        }
        .detail-title { font-size: 2.5rem; font-weight: 600; margin-bottom: 0.5rem; letter-spacing: -0.02em; }
        .detail-subtitle { font-size: 1.2rem; color: var(--accent-gray); margin-bottom: 3rem; }
        .info-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem; margin: 3rem 0;
        }
        .info-item { background: var(--light-gray); padding: 1.5rem; }
        .info-label { font-size: 0.9rem; color: var(--accent-gray); margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em;}
        .info-value { font-size: 1.1rem; font-weight: 500; word-break: break-all; }

        /* --- Î°úÎî© & Í≤∞Í≥º ÏóÜÏùå --- */
        .status-message {
            text-align: center; padding: 6rem 0; color: var(--accent-gray);
        }
        .spinner {
            width: 40px; height: 40px; border: 3px solid var(--medium-gray);
            border-top-color: var(--primary-black); border-radius: 50%;
            animation: spin 0.8s linear infinite; margin: 0 auto 1rem;
        }

        /* --- Î∞îÏΩîÎìú Ïä§Ï∫êÎÑà Î™®Îã¨ --- */
        .scanner-modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.7);
            z-index: 2000; display: none; align-items: center; justify-content: center;
        }
        .scanner-modal.active { display: flex; }
        .scanner-content {
            background: var(--primary-white); max-width: 500px; width: 90%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        .scanner-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 1rem 1.5rem; border-bottom: 1px solid var(--light-gray);
        }
        .scanner-title { font-size: 1.1rem; font-weight: 600; }
        .close-scanner-btn { font-size: 1.5rem; background: none; border: none; }
        .scanner-viewport-container { position: relative; background: #000; height: 250px; overflow: hidden; }
        #scanner-viewport video, #scanner-viewport canvas { width: 100%; height: 100%; object-fit: cover; }
        .scan-overlay {
            position: absolute; inset: 0; display: flex;
            align-items: center; justify-content: center;
        }
        .scan-guide {
            width: 250px; height: 100px; border: 2px solid rgba(255,255,255,0.5);
        }
        .scan-line {
            position: absolute; top: 0; left: 50%; transform: translateX(-50%);
            width: 2px; height: 100%; background: #00ff00;
            animation: scan-anim 2s linear infinite;
        }
        @keyframes scan-anim { 0% { transform: translateY(-100%); } 100% { transform: translateY(100%); } }
        
        .manual-input-area { padding: 1.5rem; background: var(--light-gray); }
        .manual-text { text-align: center; font-size: 0.9rem; color: var(--accent-gray); margin-bottom: 1rem; }
        .barcode-input {
            width: 100%; padding: 0.8rem; border: 1px solid var(--medium-gray);
            font-size: 1rem; text-align: center; margin-bottom: 1rem;
        }
        .search-barcode-btn {
            width: 100%; padding: 0.8rem; background: var(--primary-black);
            color: var(--primary-white); border: none; font-size: 1rem; font-weight: 500;
            transition: opacity 0.3s;
        }
        .search-barcode-btn:hover { opacity: 0.8; }
        
        /* --- Ìë∏ÌÑ∞ --- */
        .footer {
            border-top: 1px solid var(--light-gray); padding: 3rem; margin-top: 6rem;
            text-align: center; color: var(--accent-gray); font-size: 0.9rem;
        }

        /* --- ÌÜ†Ïä§Ìä∏ Î©îÏãúÏßÄ --- */
        .toast {
            position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%);
            background: var(--primary-black); color: var(--primary-white);
            padding: 12px 20px; border-radius: 8px; font-size: 14px;
            z-index: 10001; transition: bottom 0.4s ease-in-out;
        }
        .toast.show { bottom: 40px; }

        /* --- Î∞òÏùëÌòï --- */
        @media (max-width: 768px) {
            body { cursor: auto; }
            .cursor { display: none; }
            .navbar { padding: 1.5rem 1.5rem; }
            .main-container { padding: 0 1.5rem; }
            .page { padding-top: 6rem; }
            .section-header, .home-section { text-align: center; }
            .section-subtitle { margin: 0 auto; }
            #searchResults .page-header { top: 73px; }
            .results-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="cursor" id="cursor"></div>

    <div class="splash-screen" id="splash">
        <div class="splash-logo">üõçÔ∏è</div>
        <div class="splash-title">KOKO</div>
    </div>

    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">KOKO</div>
            <button class="lang-btn" onclick="toggleLanguage()">
                <span id="langFlag">üá∞üá∑</span>
                <span id="langCode">KR</span>
            </button>
        </div>
    </nav>

    <div class="main-container">
        <div class="page active" id="home">
            <div class="home-section">
                <div class="section-header">
                    <h1 class="section-title" id="appTitle">Easily Find Korean Products</h1>
                    <p class="section-subtitle" id="appSubtitle">Choose your search method below.</p>
                </div>
                <div class="search-options-grid">
                    <div class="search-option-card" onclick="showPage('searchResults')">
                        <div class="option-icon">üîç</div>
                        <h3 class="option-title" id="searchByName">Search by Name</h3>
                        <p class="option-desc" id="searchByNameDesc">Find products using their name or brand.</p>
                    </div>
                    <div class="search-option-card" onclick="openBarcodeScanner()">
                        <div class="option-icon">üìä</div>
                        <h3 class="option-title" id="scanBarcode">Scan Barcode</h3>
                        <p class="option-desc" id="scanBarcodeDesc">Find products accurately with their barcode.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="page" id="searchResults">
            <div class="page-header">
                <button class="back-btn" onclick="showPage('home')">‚Üê</button>
                <input type="text" class="search-input" id="searchInput" placeholder="Enter product name...">
            </div>
            <div id="resultsContainer">
                </div>
        </div>

        <div class="page" id="detail">
             <div class="page-header">
                <button class="back-btn" onclick="history.back()">‚Üê</button>
                <h2 class="page-title" id="productDetailTitle">Product Details</h2>
            </div>
            <div class="detail-content" id="detailContent">
                </div>
        </div>
    </div>
    
    <div class="footer">
        <p>¬© 2025 KOKO. Powered by FoodSafetyKorea API.</p>
    </div>

    <div class="scanner-modal" id="scannerModal">
        <div class="scanner-content">
            <div class="scanner-header">
                <h3 class="scanner-title" id="barcodeScanTitle">Barcode Scanner</h3>
                <button class="close-scanner-btn" onclick="closeScanner()">√ó</button>
            </div>
            <div class="scanner-viewport-container">
                <div id="scanner-viewport"></div>
                <div class="scan-overlay">
                    <div class="scan-guide"></div>
                </div>
            </div>
            <div class="manual-input-area">
                <p class="manual-text" id="manualInputText">Or enter barcode number manually</p>
                <input type="text" class="barcode-input" id="manualBarcode" placeholder="8801234567890">
                <button class="search-barcode-btn" id="searchBarcodeBtn" onclick="searchByManualBarcode()">Search</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    <script>
        // --- API & ÏÑ§Ï†ï ---
        const FOOD_API_KEY = 'c320de96f22d4183bd13';
        const TRANSLATE_API_KEY = 'AIzaSyArr1P7f6JuAL8Xz8ECiHi8WkfbNRn4Z7I'; // üö® Ïã§Ï†ú API ÌÇ§Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.
        const PROXY_URL = 'https://api.allorigins.win/raw?url=';
        const FOOD_API_BASE = `https://openapi.foodsafetykorea.go.kr/api/${FOOD_API_KEY}/C005/json`;

        // --- Ï†ÑÏó≠ Î≥ÄÏàò ---
        let currentLang = 'en';
        let currentProduct = null;
        let searchCache = null;

        // --- Îã§Íµ≠Ïñ¥ ÌÖçÏä§Ìä∏ ---
        const translations = {
            ko: {
                appTitle: 'ÌïúÍµ≠ Ï†úÌíàÏùÑ ÏâΩÍ≤å Ï∞æÏïÑÎ≥¥ÏÑ∏Ïöî', appSubtitle: 'ÏïÑÎûòÏóêÏÑú Í≤ÄÏÉâ Î∞©Î≤ïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.',
                searchByName: 'ÏÉÅÌíàÎ™Ö Í≤ÄÏÉâ', searchByNameDesc: 'Ïù¥Î¶ÑÏù¥ÎÇò Î∏åÎûúÎìúÎ°ú Ï†úÌíà Ï∞æÍ∏∞',
                scanBarcode: 'Î∞îÏΩîÎìú Ïä§Ï∫î', scanBarcodeDesc: 'Î∞îÏΩîÎìúÎ°ú Ï†ïÌôïÌïòÍ≤å Ï†úÌíà Ï∞æÍ∏∞',
                searchPlaceholder: 'ÏÉÅÌíàÎ™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî...', productDetail: 'ÏÉÅÌíà ÏÉÅÏÑ∏ Ï†ïÎ≥¥',
                manufacturer: 'Ï†úÏ°∞ÏÇ¨', expiry: 'ÏÜåÎπÑÍ∏∞Ìïú', barcode: 'Î∞îÏΩîÎìú', reportNumber: 'ÌíàÎ™©Î≥¥Í≥†Î≤àÌò∏',
                manufacturerInfo: 'Ï†úÏ°∞ÏÇ¨ Ï†ïÎ≥¥', noAddress: 'Ï£ºÏÜå Ï†ïÎ≥¥ ÏóÜÏùå', searching: 'Í≤ÄÏÉâ Ï§ë...',
                noResults: 'Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§', loadingInfo: 'Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...',
                errorLoading: 'Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§',
                barcodeTitle: 'Î∞îÏΩîÎìú Ïä§Ï∫êÎÑà', barcodeInstruction: 'Î∞îÏΩîÎìúÎ•º ÌôîÎ©¥ Ï§ëÏïôÏóê ÎßûÏ∂∞Ï£ºÏÑ∏Ïöî',
                manualInput: 'ÎòêÎäî Î∞îÏΩîÎìú Î≤àÌò∏Î•º ÏßÅÏ†ë ÏûÖÎ†•ÌïòÏÑ∏Ïöî', search: 'Í≤ÄÏÉâ',
                product_found: 'ÏÉÅÌíàÏùÑ Ï∞æÏïòÏäµÎãàÎã§!', product_not_found: 'ÏÉÅÌíàÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.',
                camera_error: 'Ïπ¥Î©îÎùºÎ•º ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏäµÎãàÎã§.', invalid_barcode: 'Ïú†Ìö®Ìïú Î∞îÏΩîÎìú Î≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.',
                translation_needed: 'Î≤àÏó≠ Í∏∞Îä•ÏùÑ ÏÇ¨Ïö©ÌïòÎ†§Î©¥ API ÌÇ§Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§.',
            },
            en: {
                appTitle: 'Easily Find Korean Products', appSubtitle: 'Choose your search method below.',
                searchByName: 'Search by Name', searchByNameDesc: 'Find products using their name or brand.',
                scanBarcode: 'Scan Barcode', scanBarcodeDesc: 'Find products accurately with their barcode.',
                searchPlaceholder: 'Enter product name...', productDetail: 'Product Details',
                manufacturer: 'Manufacturer', expiry: 'Shelf Life', barcode: 'Barcode', reportNumber: 'Report No.',
                manufacturerInfo: 'Manufacturer Info', noAddress: 'No address information', searching: 'Searching...',
                noResults: 'No search results found', loadingInfo: 'Loading information...',
                errorLoading: 'An error occurred while loading details',
                barcodeTitle: 'Barcode Scanner', barcodeInstruction: 'Align barcode to the center of the screen',
                manualInput: 'Or enter barcode number manually', search: 'Search',
                product_found: 'Product Found!', product_not_found: 'Product not found.',
                camera_error: 'Could not access the camera.', invalid_barcode: 'Please enter a valid barcode number.',
                translation_needed: 'API key is required for translation.',
            },
             ja: {
                appTitle: 'ÈüìÂõΩË£ΩÂìÅ„ÇíÁ∞°Âçò„Å´Ë¶ã„Å§„Åë„Çà„ÅÜ', appSubtitle: '‰∏ã„ÅÆÊ§úÁ¥¢ÊñπÊ≥ï„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ',
                searchByName: 'ÂïÜÂìÅÂêç„ÅßÊ§úÁ¥¢', searchByNameDesc: 'ÂïÜÂìÅÂêç„ÇÑ„Éñ„É©„É≥„Éâ„ÅßË£ΩÂìÅ„ÇíÊ§úÁ¥¢',
                scanBarcode: '„Éê„Éº„Ç≥„Éº„Éâ„Çí„Çπ„Ç≠„É£„É≥', scanBarcodeDesc: '„Éê„Éº„Ç≥„Éº„Éâ„ÅßÊ≠£Á¢∫„Å´Ë£ΩÂìÅ„ÇíÊ§úÁ¥¢',
                searchPlaceholder: 'ÂïÜÂìÅÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ...', productDetail: 'ÂïÜÂìÅË©≥Á¥∞',
                manufacturer: 'Ë£ΩÈÄ†Á§æ', expiry: 'Ê∂àË≤ªÊúüÈôê', barcode: '„Éê„Éº„Ç≥„Éº„Éâ', reportNumber: 'ÂìÅÁõÆÂ†±ÂëäÁï™Âè∑',
                manufacturerInfo: 'Ë£ΩÈÄ†Á§æÊÉÖÂ†±', noAddress: '‰ΩèÊâÄÊÉÖÂ†±„Å™„Åó', searching: 'Ê§úÁ¥¢‰∏≠...',
                noResults: 'Ê§úÁ¥¢ÁµêÊûú„Åå„ÅÇ„Çä„Åæ„Åõ„Çì', loadingInfo: 'ÊÉÖÂ†±„ÇíË™≠„ÅøËæº„Çì„Åß„ÅÑ„Åæ„Åô...',
                errorLoading: 'ÊÉÖÂ†±„ÅÆË™≠„ÅøËæº„Åø‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü',
                barcodeTitle: '„Éê„Éº„Ç≥„Éº„Éâ„Çπ„Ç≠„É£„Éä„Éº', barcodeInstruction: '„Éê„Éº„Ç≥„Éº„Éâ„ÇíÁîªÈù¢‰∏≠Â§Æ„Å´Âêà„Çè„Åõ„Å¶„Åè„Å†„Åï„ÅÑ',
                manualInput: '„Åæ„Åü„ÅØ„Éê„Éº„Ç≥„Éº„ÉâÁï™Âè∑„ÇíÁõ¥Êé•ÂÖ•Âäõ', search: 'Ê§úÁ¥¢',
                product_found: 'Ë£ΩÂìÅ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åó„ÅüÔºÅ', product_not_found: 'Ë£ΩÂìÅ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ',
                camera_error: '„Ç´„É°„É©„Å´„Ç¢„ÇØ„Çª„Çπ„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ', invalid_barcode: 'ÊúâÂäπ„Å™„Éê„Éº„Ç≥„Éº„ÉâÁï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                translation_needed: 'ÁøªË®≥„Å´„ÅØAPI„Ç≠„Éº„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ',
            }
        };

        const getText = (key) => translations[currentLang][key] || key;

        // --- Ï¥àÍ∏∞Ìôî Î∞è UI Ïù¥Î≤§Ìä∏ ---
        document.addEventListener('DOMContentLoaded', () => {
            // Ïä§ÌîåÎûòÏãú
            setTimeout(() => {
                document.getElementById('splash').classList.add('fade-out');
                setTimeout(() => document.getElementById('splash').style.display = 'none', 500);
            }, 1500);

            // Ïª§ÏÑú
            const cursor = document.getElementById('cursor');
            window.addEventListener('mousemove', e => {
                cursor.style.left = e.clientX + 'px';
                cursor.style.top = e.clientY + 'px';
            });
            document.querySelectorAll('a, button, input, .search-option-card, .result-card').forEach(el => {
                el.addEventListener('mouseenter', () => cursor.classList.add('hover'));
                el.addEventListener('mouseleave', () => cursor.classList.remove('hover'));
            });

            // Í≤ÄÏÉâ ÏûÖÎ†•
            let searchTimeout;
            document.getElementById('searchInput').addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                const query = e.target.value.trim();
                if (query.length < 2) { 
                    document.getElementById('resultsContainer').innerHTML = '';
                    return; 
                }
                searchTimeout = setTimeout(() => searchProducts(query), 300);
            });
            
            // Ï¥àÍ∏∞ UI ÌÖçÏä§Ìä∏ ÏÑ§Ï†ï
            updateUITexts();
        });
        
        // --- ÌéòÏù¥ÏßÄ Î∞è Î™®Îã¨ Í¥ÄÎ¶¨ ---
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            const newPage = document.getElementById(pageId);
            if(newPage) {
                newPage.classList.add('active');
                window.scrollTo(0, 0);

                // ÌéòÏù¥ÏßÄÎ≥Ñ Ï¥àÍ∏∞Ìôî Î°úÏßÅ
                if(pageId === 'searchResults') {
                    document.getElementById('searchInput').focus();
                } else if (pageId === 'home') {
                    document.getElementById('searchInput').value = '';
                    document.getElementById('resultsContainer').innerHTML = '';
                }
            }
        }
        
        function openBarcodeScanner() { document.getElementById('scannerModal').classList.add('active'); startScanning(); }
        function closeScanner() { stopScanning(); document.getElementById('scannerModal').classList.remove('active'); }

        // --- ÌïµÏã¨ Í∏∞Îä• Ìï®Ïàò ---
        function updateUITexts() {
            document.getElementById('appTitle').textContent = getText('appTitle');
            document.getElementById('appSubtitle').textContent = getText('appSubtitle');
            document.getElementById('searchByName').textContent = getText('searchByName');
            document.getElementById('searchByNameDesc').textContent = getText('searchByNameDesc');
            document.getElementById('scanBarcode').textContent = getText('scanBarcode');
            document.getElementById('scanBarcodeDesc').textContent = getText('scanBarcodeDesc');
            document.getElementById('searchInput').placeholder = getText('searchPlaceholder');
            document.getElementById('productDetailTitle').textContent = getText('productDetail');
            document.getElementById('barcodeScanTitle').textContent = getText('barcodeTitle');
            document.getElementById('manualInputText').textContent = getText('manualInput');
            document.getElementById('searchBarcodeBtn').textContent = getText('search');
        }

        function toggleLanguage() {
            const langs = ['en', 'ko', 'ja'];
            const flags = { en: 'üá∫üá∏', ko: 'üá∞üá∑', ja: 'üáØüáµ' };
            const codes = { en: 'EN', ko: 'KR', ja: 'JP' };
            
            const nextLangIndex = (langs.indexOf(currentLang) + 1) % langs.length;
            currentLang = langs[nextLangIndex];

            if (currentLang !== 'ko' && (!TRANSLATE_API_KEY || TRANSLATE_API_KEY.startsWith('AIzaSy'))) {
                showToast(getText('translation_needed'));
                currentLang = 'ko'; // ÌïúÍµ≠Ïñ¥Î°ú ÎêòÎèåÎ¶º
            }

            document.getElementById('langFlag').textContent = flags[currentLang];
            document.getElementById('langCode').textContent = codes[currentLang];
            updateUITexts();
        }

        async function fetchAllProducts() {
            if (searchCache) return searchCache;
            const url = `${FOOD_API_BASE}/1/1000`; // ÏµúÎåÄ 1000Í∞ú Îç∞Ïù¥ÌÑ∞ Ï∫êÏã±
            try {
                const response = await fetch(PROXY_URL + encodeURIComponent(url));
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                searchCache = data.C005 && data.C005.row ? data.C005.row : [];
                return searchCache;
            } catch (error) {
                console.error("Error fetching all products:", error);
                showToast("Error fetching product data.");
                return [];
            }
        }

        async function searchProducts(query) {
            const container = document.getElementById('resultsContainer');
            container.innerHTML = `<div class="status-message"><div class="spinner"></div>${getText('searching')}</div>`;

            const allProducts = await fetchAllProducts();
            const lowerCaseQuery = query.toLowerCase();
            
            const results = allProducts.filter(p => 
                (p.PRDLST_NM && p.PRDLST_NM.toLowerCase().includes(lowerCaseQuery)) ||
                (p.BSSH_NM && p.BSSH_NM.toLowerCase().includes(lowerCaseQuery))
            ).slice(0, 20); // ÏµúÎåÄ 20Í∞ú Í≤∞Í≥º ÌëúÏãú

            if (results.length === 0) {
                container.innerHTML = `<div class="status-message">${getText('noResults')}</div>`;
                return;
            }

            container.innerHTML = `<div class="results-grid"></div>`;
            const grid = container.querySelector('.results-grid');
            results.forEach((product, index) => {
                const card = document.createElement('div');
                card.className = 'result-card';
                card.innerHTML = `
                    <h3 class="result-name">${product.PRDLST_NM}</h3>
                    <p class="result-desc">${product.PRDLST_DCNM || 'Food'}</p>
                    <p class="result-company">${product.BSSH_NM}</p>
                `;
                card.onclick = () => showProductDetail(product);
                grid.appendChild(card);
            });
        }
        
        async function findProductByBarcode(barcode) {
            showToast(`${getText('searching')}... ${barcode}`);
            const url = `${FOOD_API_BASE}/1/5/BAR_CD=${barcode}`;
            try {
                const response = await fetch(PROXY_URL + encodeURIComponent(url));
                const data = await response.json();
                if (data.C005 && data.C005.row) {
                    const product = Array.isArray(data.C005.row) ? data.C005.row[0] : data.C005.row;
                    showToast(getText('product_found'));
                    closeScanner();
                    showProductDetail(product);
                } else {
                    showToast(getText('product_not_found'));
                }
            } catch (error) {
                console.error("Barcode search error:", error);
                showToast("An error occurred during barcode search.");
            }
        }
        
        async function showProductDetail(product) {
            currentProduct = product;
            const content = document.getElementById('detailContent');
            showPage('detail');
            content.innerHTML = `<div class="status-message"><div class="spinner"></div>${getText('loadingInfo')}</div>`;

            try {
                const [pName, pDesc, pCompany, pAddr] = await Promise.all([
                    translateText(product.PRDLST_NM || ''),
                    translateText(product.PRDLST_DCNM || ''),
                    translateText(product.BSSH_NM || ''),
                    translateText(product.SITE_ADDR || '')
                ]);

                content.innerHTML = `
                    <div class="detail-hero">üõçÔ∏è</div>
                    <h1 class="detail-title">${pName}</h1>
                    <p class="detail-subtitle">${pDesc}</p>
                    <div class="info-grid">
                        <div class="info-item">
                            <p class="info-label">${getText('manufacturer')}</p>
                            <p class="info-value">${pCompany || '-'}</p>
                        </div>
                        <div class="info-item">
                            <p class="info-label">${getText('expiry')}</p>
                            <p class="info-value">${product.POG_DAYCNT || '-'}</p>
                        </div>
                        <div class="info-item">
                            <p class="info-label">${getText('barcode')}</p>
                            <p class="info-value">${product.BAR_CD || '-'}</p>
                        </div>
                        <div class="info-item">
                            <p class="info-label">${getText('reportNumber')}</p>
                            <p class="info-value">${product.PRDLST_REPORT_NO || '-'}</p>
                        </div>
                    </div>
                     <h3 style="font-weight:500; margin:3rem 0 1rem 0;">${getText('manufacturerInfo')}</h3>
                     <p style="color:var(--accent-gray);">${pAddr || getText('noAddress')}</p>
                `;
            } catch (error) {
                console.error("Detail page error:", error);
                content.innerHTML = `<div class="status-message">${getText('errorLoading')}</div>`;
            }
        }
        
        // --- Î≥¥Ï°∞ Ìï®Ïàò (Î≤àÏó≠, ÌÜ†Ïä§Ìä∏ Îì±) ---
        async function translateText(text) {
            if (currentLang === 'ko' || !text || !TRANSLATE_API_KEY || TRANSLATE_API_KEY.startsWith('AIzaSy')) {
                return text;
            }
            try {
                const response = await fetch(`https://translation.googleapis.com/language/translate/v2?key=${TRANSLATE_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ q: text, target: currentLang, source: 'ko' })
                });
                if (!response.ok) throw new Error('Translation API error');
                const data = await response.json();
                return data.data.translations[0].translatedText;
            } catch (error) {
                console.error('Translation failed:', error);
                return text; // Î≤àÏó≠ Ïã§Ìå® Ïãú ÏõêÎ≥∏ ÌÖçÏä§Ìä∏ Î∞òÌôò
            }
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // --- Î∞îÏΩîÎìú Ïä§Ï∫êÎÑà (Quagga.js) ---
        let isScanning = false;
        function startScanning() {
            if(isScanning) return;
            Quagga.init({
                inputStream: {
                    name: "Live", type: "LiveStream",
                    target: document.querySelector('#scanner-viewport'),
                    constraints: { width: 480, height: 320, facingMode: "environment" },
                },
                decoder: { readers: ["ean_reader", "ean_8_reader", "code_128_reader"] },
            }, (err) => {
                if (err) {
                    console.error(err);
                    showToast(getText('camera_error'));
                    return;
                }
                Quagga.start();
                isScanning = true;
            });
            Quagga.onDetected(onBarcodeDetected);
        }

        function stopScanning() {
            if(isScanning) {
                Quagga.offDetected(onBarcodeDetected);
                Quagga.stop();
                isScanning = false;
            }
        }

        let lastBarcode = null;
        let lastBarcodeTime = null;
        const onBarcodeDetected = (result) => {
            const barcode = result.codeResult.code;
            const now = new Date().getTime();
            // Ï§ëÎ≥µ Ïä§Ï∫î Î∞©ÏßÄ (2Ï¥à Ïù¥ÎÇ¥ ÎèôÏùº Î∞îÏΩîÎìú Î¨¥Ïãú)
            if (barcode === lastBarcode && (now - lastBarcodeTime) < 2000) {
                return;
            }
            lastBarcode = barcode;
            lastBarcodeTime = now;
            
            stopScanning(); // ÏÑ±Í≥µ Ïãú Ï¶âÏãú Ï§ëÏßÄ
            findProductByBarcode(barcode);
        };
        
        function searchByManualBarcode() {
            const barcode = document.getElementById('manualBarcode').value.trim();
            if(barcode.length < 8) {
                showToast(getText('invalid_barcode'));
                return;
            }
            findProductByBarcode(barcode);
        }

    </script>
</body>
</html>
